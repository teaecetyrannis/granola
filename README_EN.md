


# granola
[leer en espa√±ol](https://github.com/teaecetyrannis/pd-granola/blob/main/README.md)
<br><br>
stochastic granular synth developed in [pure data](https://github.com/pure-data/pure-data)


## installation
download granola.zip file from the [last release](https://github.com/teaecetyrannis/pd-granola/releases), extract and add the containing folder to pure data path, then it can be started in any patch by creating the `[granola~]` object
<br><br>it also depends on the [adsr](https://github.com/teaecetyrannis/pd-adsr) abstraction and the `[selector~]` object from the [cyclone](https://github.com/porres/pd-cyclone) library, so these should necessarily be installed as well

## operation
the synth features:

1. grain
	- **durat.**: controls grain duration (*ms* or *samps*)
	- **autotrigger**: turns on or off the automatic triggering of grains based on the set rate, if turned off it will only be possible to trigger them on by receiving a `[bang]` from the second inlet
	- **rate**: controls frequency at which grains are triggered (*ms* or *samps*)

2. sample
	- **load**: used to find the audio file (in .wav format) that will be used as the main sample
	- **playhead position**
	- **play**: if turned on, moves the playhead through the sample at the indicated speed (in other words, it resumes or pauses sample playback)
	- **reset_on_noteon**: when **play** is turned on, determines if the playhead will be one for all voices (off) or if each new note will begin to play the sample from **playhead position** independently (on)
	<br>keep in mind that when turned on moving the **playhead position** will have no effect since it's just determining at which point of the sample will the next note begin, whereas if it's turned off all voices will share the same playhead which can be altered by changing the **playhead position**
	- **speed**: determines the speed at which the playhead/s will move (*%*)
	<br>the slider found above can be used too, which goes from -300 to 300, for a more intuitive control if using a mouse
	- **note**: used to indicate which is the "note" (*midi*) of the sample so that it matches the notes that go into the synth, but also allows for more creative use cases that this one

3. window
	- **shape**: determines the shape of the window that is applied to each grain (*straight, cos, tri, tridown, triup, custom*)
	- **load**: used to find the audio file (in .wav format) that will be used as the *custom* shape, the window is always 2048 samples long and if the loaded file is longer only the first 2048 samples will be kept
	- **smooth**: if turned on, a second window will be used for each grain applying brief ramps from and to 0 at the beginning and end, this is to avoid the impulses generated by window shapes that don't start or end at 0

4. envelope
	- attack (*ms*), decay (*ms*), sustain (*%*) and release (*ms*)
	- controls for switching between monophonic and polyphonic, voice-stealing, legato and behaviour of pitch bend (_global_ applies bending to all active voices of the polyphony and _last_ applies it only to the newest voice)

5. offsets: the synth has three panels which allow to change the values of three parameters: playhead position (*ms* or *samp*), pitch (*midi* or *cents*) and duration (*ms* or *samps*) from left to right
	- **offset**: how much is added or substracted from the current value of each parameter
	- **chance**: the chance (*0-100%*) that said operation gets executed for each individual grain
	- **precision**: defines the margin of possible outcomes (*0-100%*), the outcome could be any number (with equal probability) that lies between the current value + precision% of the **offset** value AND the current value + 100% of the **offset** value
	<br>example: if set to *100* the outcome will always be the current value + the **offset** value, if set to *50* the outcome could be any number between the current value + 50% of the offset value AND the current value + the **offset** value (all of them equally probable)

WARNING:
- keep in mind that when loading audio files the abstraction will save the path for said files and it is there that it will look for them the next time it receives a state message, in case of making use of it
- when in polyphonic mode and especially if using very small **rate** values cpu usage may increase quite a bit with each voice, technically it allows up to 16 voices but in the pc i develop with (i5-4440) the buffer overflows before using them all


## documentation, dynamically setting parameters and saving the state of the synth
in the `[pd help]` subpatch inside granola~.pd you will find all this same information and also details on its inlets and outlets and how to set all the parameters from outside via messages, allowing a completely dynamic control of the synth without using the interface
<br>thanks to this it's also possible to fully remember the state of the synthesizer: it only needs a very long message that includes all the current values for each parameter... luckily this function is already built-in and all there is to do is connecting a message (doesn't have to be empty since its content will be replaced) to the third outlet and then send a `[state(` message to the second inlet, this will write all parameters and file paths to the message


## credits
[pure data](https://github.com/pure-data/pure-data) by miller puckette and many others
